<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cidade Firme — Jeremias 52</title>
  <style>
    body { margin:0; background:#1e272e; color:#ecf0f1; font-family:'Trebuchet MS',sans-serif; display:flex; }
    #game-area { flex:3; position:relative; text-align:center; }
    #sidebar { flex:1; background:#2f3640; padding:20px; box-sizing:border-box; }
    h1 { color:#fbc531; }
    canvas { background:#718093; display:block; margin:0 auto; border:4px solid #353b48; }
    #questions { margin-top:10px; }
    button { background:#00a8ff; color:#fff; border:none; padding:10px 15px; margin:5px; border-radius:8px; cursor:pointer; }
    button:hover { background:#0097e6; }
    .block-label { position:absolute; font-weight:bold; color:#2c3e50; text-align:center; pointer-events:none; }
    #ranking h2 { color:#f5f6fa; margin-top:0; }
    #ranking ol { padding-left:20px; }
    #player-info input { width:100%; padding:8px; margin:5px 0; border:none; border-radius:5px; }
  </style>
</head>
<body>
  <div id="game-area">
    <h1>Cidade Firme — Jeremias 52</h1>
    <canvas id="world"></canvas>
    <div id="questions">
      <p id="question-text">Responda para construir sua cidade:</p>
      <div id="answers"></div>
    </div>
  </div>
  <div id="sidebar">
    <div id="player-info">
      <h2>Jogador</h2>
      <input id="player-name" placeholder="Nome" />
      <input id="player-role" placeholder="Cargo" />
    </div>
    <div id="ranking">
      <h2>Ranking</h2>
      <ol id="ranking-list">
        <li>---</li>
        <li>---</li>
        <li>---</li>
      </ol>
    </div>
    <p>Pontos: <span id="points">0</span></p>
  </div>

  <audio id="sound-drop" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="sound-fall" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>
    const { Engine, Render, Runner, Bodies, Composite, Events } = Matter;
    const engine = Engine.create();
    const world = engine.world;
    const canvas = document.getElementById('world');
    canvas.width = window.innerWidth*0.7;
    canvas.height = window.innerHeight*0.7;

    const render = Render.create({ canvas:canvas, engine:engine, options:{ width:canvas.width, height:canvas.height, wireframes:false, background:'#718093' } });
    Render.run(render);
    Runner.run(Runner.create(), engine);

    const ground = Bodies.rectangle(canvas.width/2, canvas.height-20, canvas.width, 40, { isStatic:true, render:{ fillStyle:'#353b48' } });
    Composite.add(world, ground);

    let points = 0;
    const labels = [];
    const perguntas = [
      {q:"Está preocupado com o futuro?", options:[{txt:"Confio em Deus", type:"spirit"},{txt:"Vou resolver sozinho", type:"human"}]},
      {q:"Recebeu uma promoção inesperada?", options:[{txt:"Dou glória a Deus", type:"spirit"},{txt:"Foi só mérito meu", type:"human"}]},
      {q:"Um problema difícil aparece", options:[{txt:"Orar primeiro", type:"spirit"},{txt:"Fico ansioso", type:"human"}]}
    ];

    function mostrarPergunta() {
      const container = document.getElementById('answers');
      container.innerHTML = '';
      const p = perguntas[Math.floor(Math.random()*perguntas.length)];
      document.getElementById('question-text').textContent = p.q;
      p.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt.txt;
        btn.onclick = ()=>responder(opt.type);
        container.appendChild(btn);
      });
    }

    function responder(type) {
      addBlock(type);
      if(type==='spirit') points+=10; else points+=5;
      document.getElementById('points').textContent = points;
      atualizarRanking();
      mostrarPergunta();
    }

    function addBlock(type) {
      const x = canvas.width/2 + (Math.random()*200-100);
      const block = Bodies.rectangle(x, 50, 100, 50, {
        restitution:0.05,
        friction: type==='spirit'?1.0:0.2,
        render:{ fillStyle:type==='spirit'?'#4cd137':'#e84118' }
      });
      Composite.add(world, block);
      const label = document.createElement('div');
      label.className='block-label';
      label.textContent = type==='spirit'?'Espiritual':'Humano';
      document.body.appendChild(label);
      labels.push({body:block,element:label,type});
      document.getElementById('sound-drop').play();
    }

    function atualizarRanking() {
      const nome = document.getElementById('player-name').value || 'Anônimo';
      const cargo = document.getElementById('player-role').value || '';
      const ranking = [ {nome:nome+ (cargo?" ("+cargo+")":""), pts: points} ];
      ranking.sort((a,b)=>b.pts-a.pts);
      const top3 = ranking.slice(0,3);
      const list = document.getElementById('ranking-list');
      list.innerHTML='';
      top3.forEach(p=>{
        const li = document.createElement('li');
        li.textContent = `${p.nome}: ${p.pts}`;
        list.appendChild(li);
      });
    }

    Events.on(engine,'afterUpdate',()=>{
      labels.forEach(l=>{
        l.element.style.left = (l.body.position.x-40)+'px';
        l.element.style.top = (l.body.position.y-20)+'px';
      });
      let humanBelow = labels.filter(l=>l.type==='human' && l.body.position.y<canvas.height-100);
      humanBelow.forEach(h=>{
        let above = labels.filter(l=>l.body.position.y < h.body.position.y && Math.abs(l.body.position.x-h.body.position.x)<50);
        if(above.length>2) {
          document.getElementById('sound-fall').play();
          document.getElementById('question-text').textContent = 'O muro perdeu a base! Jeremias 52: sem fundamentos espirituais, a cidade cai.';
        }
      });
    });

    mostrarPergunta();
  </script>
</body>
</html>
